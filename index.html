<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Prevent search engine indexing -->
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet, noimageindex">
    <meta name="googlebot" content="noindex, nofollow">
    <meta name="googlebot-news" content="noindex, nofollow">
    <meta name="slurp" content="noindex, nofollow">
    <meta name="msnbot" content="noindex, nofollow">
    <meta name="bingbot" content="noindex, nofollow">
    <meta name="yandex" content="noindex, nofollow">
    <meta name="baiduspider" content="noindex, nofollow">
    <!-- Prevent caching -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="theme-color" content="#3b82f6">
    <meta name="description" content="A web application for managing rental properties and tenants">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <link rel="icon" type="image/png" href="icons/icon-192x192.png">
    <title>Rental Management System</title>
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><path d='M16 4L4 14V28H28V14L16 4Z' fill='%234A90E2'/><rect x='12' y='18' width='8' height='10' fill='%232C3E50'/><rect x='20' y='12' width='4' height='4' fill='%232C3E50'/><rect x='8' y='12' width='4' height='4' fill='%232C3E50'/><path d='M4 14L16 4L28 14' stroke='%232C3E50' stroke-width='2'/></svg>">
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Prevent flash of incorrect theme -->
    <script>
        // Immediately set theme before page loads
        (function() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                document.documentElement.setAttribute('data-theme', savedTheme);
            } else {
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                document.documentElement.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
            }
        })();
    </script>
</head>
<body>
    <div class="container">
        <div class="plot-tabs">
            <button class="plot-tab active" data-plot="home">
                <i class="fas fa-home"></i>
                Home
            </button>
            <button class="plot-tab" data-plot="baba">
                <i class="fas fa-building"></i>
                Baba
            </button>
            <button class="plot-tab" data-plot="shop">
                <i class="fas fa-store"></i>
                Shop
            </button>
            <button class="plot-tab" data-plot="others">
                <i class="fas fa-ellipsis-h"></i>
                Others
            </button>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <button class="sidebar-toggle" id="sidebar-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                <button class="nav-btn" data-section="tenants">
                    <i class="fas fa-list"></i>
                    View Tenants
                </button>
                <button class="nav-btn" data-section="summary">
                    <i class="fas fa-chart-pie"></i>
                    Summary
                </button>
                <button class="nav-btn" data-section="add-tenant">
                    <i class="fas fa-user-plus"></i>
                    Add New Tenant
                </button>
                <button class="nav-btn" data-section="payment-history">
                    <i class="fas fa-history"></i>
                    Payment History
                </button>
                <button class="nav-btn" data-section="data-management">
                    <i class="fas fa-database"></i>
                    Data Management
                </button>
            </div>

            <div class="content-area">
                <!-- Summary Section -->
                <section id="summary" class="section">
                    <h2><i class="fas fa-chart-pie"></i> Summary</h2>
                    <div class="summary-stats">
                        <div class="stat-card">
                            <i class="fas fa-users"></i>
                            <span id="total-tenants">0</span>
                            <label>Tenants</label>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-money-bill-wave"></i>
                            <span id="total-rent">₹0</span>
                            <label>Due</label>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-calendar-check"></i>
                            <span id="current-month-payments">₹0</span>
                            <label>Payments</label>
                        </div>
                    </div>
                </section>

                <!-- View Tenants Section -->
                <section id="tenants" class="section">
                    <div class="section-header">
                        <h2>Tenant</h2>
                        <div class="search-bar">
                            <i class="fas fa-search"></i>
                            <input type="text" id="search-tenant" placeholder="Search tenant...">
                        </div>
                    </div>
                    <div class="tenants-list" id="tenants-list">
                        <!-- Tenants will be displayed here -->
                    </div>
                </section>

                <!-- Add New Tenant Section -->
                <section id="add-tenant" class="section">
                    <h2><i class="fas fa-user-plus"></i> Add New Tenant</h2>
                    <form id="tenant-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="room-number">Room Number:</label>
                                <input type="text" id="room-number" required>
                            </div>
                            <div class="form-group">
                                <label for="tenant-name">Tenant Name:</label>
                                <input type="text" id="tenant-name" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="start-date">Start Date:</label>
                                <input type="date" id="start-date" required>
                            </div>
                            <div class="form-group">
                                <label for="monthly-rent">Monthly Rent:</label>
                                <input type="number" id="monthly-rent" required min="0" step="0.01">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="advance-paid">Advance Paid:</label>
                                <input type="number" id="advance-paid" required min="0" step="0.01">
                            </div>
                            <div class="form-group">
                                <label for="starting-due">Starting Due Amount:</label>
                                <input type="number" id="starting-due" value="0" min="0" step="0.01">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="electricity-rate">Electricity Rate (per unit):</label>
                                <input type="number" id="electricity-rate" value="10" required min="0" step="0.01">
                            </div>
                            <div class="form-group">
                                <label for="starting-electricity">Starting Electricity Reading:</label>
                                <input type="number" id="starting-electricity" required min="0" step="0.01">
                            </div>
                        </div>
                        <button type="submit" class="submit-btn">
                            <i class="fas fa-save"></i> Add Tenant
                        </button>
                    </form>
                </section>

                <!-- Payment History Section -->
                <section id="payment-history" class="section">
                    <h2><i class="fas fa-history"></i> Payment History</h2>
                    <div class="payment-filters">
                        <select id="payment-tenant-select">
                            <option value="">All Tenants</option>
                        </select>
                        <input type="month" id="payment-month">
                    </div>
                    <div class="payment-summary">
                        <div class="summary-card">
                            <i class="fas fa-money-bill-wave"></i>
                            <span id="total-payments">₹0</span>
                            <label>Total Payments</label>
                        </div>
                        <div class="summary-card" id="monthly-summary" style="display: none;">
                            <i class="fas fa-calendar-check"></i>
                            <span id="monthly-payments">₹0</span>
                            <label>Monthly Payments</label>
                        </div>
                    </div>
                    <div class="payment-history-list" id="payment-history-list">
                        <!-- Payment history will be displayed here -->
                    </div>
                </section>

                <!-- Data Management Section -->
                <section id="data-management" class="section">
                    <h2><i class="fas fa-database"></i> Data Management</h2>
                    <div class="data-management-buttons">
                        <button id="export-data" class="action-btn">
                            <i class="fas fa-download"></i> Export Data
                        </button>
                        <label for="import-data" class="action-btn">
                            <i class="fas fa-upload"></i> Import Data
                            <input type="file" id="import-data" accept=".json" style="display: none;">
                        </label>
                    </div>
                </section>
            </div>
        </div>
    </div>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="script.js"></script>
    <script>
        // Debug function
        function debug(message) {
            console.log(`[PWA Debug] ${message}`);
        }

        // Check if service workers are supported
        if ('serviceWorker' in navigator) {
            debug('Service Workers are supported');
            
            // Check if the page is served over HTTPS
            if (window.location.protocol === 'https:' || window.location.hostname === 'localhost') {
                debug('Page is served over HTTPS or localhost');
                
                window.addEventListener('load', async () => {
                    try {
                        debug('Attempting to register service worker...');
                        const registration = await navigator.serviceWorker.register('./sw.js', {
                            scope: './'
                        });
                        
                        debug(`Service Worker registered successfully with scope: ${registration.scope}`);
                        
                        // Check if the service worker is active
                        if (registration.active) {
                            debug('Service Worker is active');
                        } else {
                            debug('Service Worker is not active yet');
                        }

                        // Listen for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            debug('Service Worker update found!');
                            
                            newWorker.addEventListener('statechange', () => {
                                debug(`Service Worker state changed to: ${newWorker.state}`);
                            });
                        });

                        // Check if the manifest is loaded
                        const manifestLink = document.querySelector('link[rel="manifest"]');
                        if (manifestLink) {
                            debug('Manifest link found');
                            fetch(manifestLink.href)
                                .then(response => response.json())
                                .then(manifest => {
                                    debug('Manifest loaded successfully');
                                    console.log('Manifest:', manifest);
                                })
                                .catch(error => {
                                    debug('Error loading manifest: ' + error.message);
                                });
                        } else {
                            debug('Manifest link not found!');
                        }

                    } catch (error) {
                        debug('Service Worker registration failed: ' + error.message);
                        console.error('Service Worker registration failed:', error);
                    }
                });
            } else {
                debug('Page is not served over HTTPS. PWA requires HTTPS.');
            }
        } else {
            debug('Service Workers are not supported in this browser');
        }
    </script>
</body>
</html> 