<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- SEO and Security -->
    <meta name="robots" content="noindex, nofollow">
    <meta name="googlebot" content="noindex, nofollow">
    <meta name="description" content="A web application for managing rental properties and tenants">
    <meta name="author" content="Rent Management System">
    <meta name="theme-color" content="#3b82f6" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#0b132b" media="(prefers-color-scheme: dark)">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' https://www.gstatic.com https://www.googleapis.com https://fonts.googleapis.com https://fonts.gstatic.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; img-src 'self' data:; connect-src 'self' https://firestore.googleapis.com; font-src https://fonts.gstatic.com https://cdnjs.cloudflare.com data:; object-src 'none'; base-uri 'self'; frame-ancestors 'none'">

    <!-- PWA -->
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
    <link rel="icon" type="image/png" href="/icons/icon-192x192.png">
    <title>Rental Management System</title>
    <!-- Styles -->
    <link rel="stylesheet" href="/styles.css?ver=1.0.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Theme Initialization moved to script.js -->
</head>

<body>
    <!-- PWA install banner -->
    <div id="install-banner" style="display:none" class="install-banner">
        <span>Add this app.</span>
        <button id="install-btn" class="install-btn">Install</button>
        <button id="dismiss-install" class="dismiss-btn" aria-label="Dismiss">×</button>
    </div>
    <!-- Notification System -->
    <div id="notification-container" class="notification-container"></div>

    <div class="container">
        <div class="plot-tabs" role="tablist" aria-label="Plots">
            <button class="plot-tab active" role="tab" aria-selected="true" aria-controls="panel-home" id="tab-home"
                tabindex="0" data-plot="home">
                <i class="fas fa-home"></i>
                Home
            </button>
            <button class="plot-tab" role="tab" aria-selected="false" aria-controls="panel-baba" id="tab-baba"
                tabindex="-1" data-plot="baba">
                <i class="fas fa-building"></i>
                Baba
            </button>
            <button class="plot-tab" role="tab" aria-selected="false" aria-controls="panel-shop" id="tab-shop"
                tabindex="-1" data-plot="shop">
                <i class="fas fa-store"></i>
                Shop
            </button>
            <button class="plot-tab" role="tab" aria-selected="false" aria-controls="panel-others" id="tab-others"
                tabindex="-1" data-plot="others">
                <i class="fas fa-ellipsis-h"></i>
                Others
            </button>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <button class="sidebar-toggle" id="sidebar-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                <button class="nav-btn" data-section="summary">
                    <i class="fas fa-chart-pie"></i>
                    Dashboard
                </button>
                <button class="nav-btn" data-section="tenants">
                    <i class="fas fa-users"></i>
                    Tenants
                </button>
                <button class="nav-btn" data-section="add-tenant">
                    <i class="fas fa-user-plus"></i>
                    Add New Tenant
                </button>
                <button class="nav-btn" data-section="payment-history">
                    <i class="fas fa-history"></i>
                    Payment History
                </button>
                <button class="nav-btn" data-section="monthly-history">
                    <i class="fas fa-calendar-alt"></i>
                    Monthly History
                </button>
                <button class="nav-btn" data-section="data-management">
                    <i class="fas fa-database"></i>
                    Data Management
                </button>
            </div>

            <div class="content-area">

                <!-- Summary Section -->
                <section id="summary" class="section">
                    <div class="dashboard-header">
                        <h2><i class="fas fa-chart-pie"></i> Dashboard</h2>
                        <div class="quick-actions">
                            <button class="quick-action-btn" data-section="add-tenant">
                                <i class="fas fa-plus"></i>
                                Add Tenant
                            </button>
                            <button class="quick-action-btn" data-action="quick-payment">
                                <i class="fas fa-money-bill-wave"></i>
                                Quick Payment
                            </button>
                        </div>
                    </div>
                    <div class="summary-stats">
                        <div class="stat-card">
                            <i class="fas fa-users"></i>
                            <span id="total-tenants">0</span>
                            <label>Tenants</label>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-money-bill-wave"></i>
                            <span id="total-rent">₹0</span>
                            <label>Due</label>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-calendar-check"></i>
                            <span id="current-month-payments">₹0</span>
                            <label>Payments</label>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-home"></i>
                            <span id="total-monthly-rent">₹0</span>
                            <label>Monthly Rent</label>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-bolt"></i>
                            <span id="total-monthly-bill">₹0</span>
                            <label>Monthly Bill</label>
                        </div>
                    </div>

                    <h2 class="combined-stats-title"><i class="fas fa-globe"></i> Combined Stats (All Plots)</h2>
                    <div class="summary-stats combined-stats">
                        <div class="stat-card">
                            <i class="fas fa-users"></i>
                            <span id="combined-total-tenants">0</span>
                            <label>Tenants</label>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-money-bill-wave"></i>
                            <span id="combined-total-rent">₹0</span>
                            <label>Due</label>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-calendar-check"></i>
                            <span id="combined-current-month-payments">₹0</span>
                            <label>Payments</label>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-home"></i>
                            <span id="combined-total-monthly-rent">₹0</span>
                            <label>Monthly Rent</label>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-bolt"></i>
                            <span id="combined-total-monthly-bill">₹0</span>
                            <label>Monthly Bill</label>
                        </div>
                    </div>
                </section>

                <!-- View Tenants Section -->
                <section id="tenants" class="section" role="region" aria-labelledby="tab-tenants">
                    <div class="section-header">
                        <h2>Tenants</h2>
                        <div class="search-bar">
                            <i class="fas fa-search"></i>
                            <input type="text" id="search-tenant" placeholder="Search by name or room...">
                        </div>
                    </div>
                    <div class="tenants-list" id="tenants-list">
                        <!-- Loading State -->
                        <div id="tenants-loading" class="loading-state" style="display: none;">
                            <div class="loading-spinner"></div>
                            <p>Loading tenants...</p>
                        </div>

                        <!-- Empty State -->
                        <div id="tenants-empty" class="empty-state" style="display: none;">
                            <i class="fas fa-users"></i>
                            <h3>No tenants found</h3>
                            <p>Get started by adding your first tenant</p>
                            <button class="empty-action-btn" data-section="add-tenant">
                                <i class="fas fa-plus"></i>
                                Add First Tenant
                            </button>
                        </div>

                        <!-- Tenants will be displayed here -->
                    </div>
                </section>

                <!-- Add New Tenant Section -->
                <section id="add-tenant" class="section">
                    <h2><i class="fas fa-user-plus"></i> Add New Tenant</h2>
                    <div class="form-progress">
                        <div class="progress-steps">
                            <div class="step active" data-step="1">
                                <span class="step-number">1</span>
                                <span class="step-label">Basic Info</span>
                            </div>
                            <div class="step" data-step="2">
                                <span class="step-number">2</span>
                                <span class="step-label">Financial</span>
                            </div>
                            <div class="step" data-step="3">
                                <span class="step-number">3</span>
                                <span class="step-label">Electricity</span>
                            </div>
                        </div>
                    </div>

                    <form id="tenant-form" class="multi-step-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="room-number">Room Number:</label>
                                <input type="text" id="room-number" required inputmode="numeric" autocomplete="on">
                            </div>
                            <div class="form-group">
                                <label for="tenant-name">Tenant Name:</label>
                                <input type="text" id="tenant-name" required autocomplete="name" autocapitalize="words"
                                    spellcheck="false">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="start-date">Start Date:</label>
                                <input type="date" id="start-date" required autocomplete="on">
                            </div>
                            <div class="form-group">
                                <label for="monthly-rent">Monthly Rent:</label>
                                <input type="number" id="monthly-rent" required min="0" step="0.01" inputmode="decimal"
                                    autocomplete="transaction-amount">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="advance-paid">Advance Paid:</label>
                                <input type="number" id="advance-paid" required min="0" step="0.01" inputmode="decimal"
                                    autocomplete="transaction-amount">
                            </div>
                            <div class="form-group">
                                <label for="starting-due">Starting Due Amount:</label>
                                <input type="number" id="starting-due" value="0" min="0" step="0.01" inputmode="decimal"
                                    autocomplete="transaction-amount">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="electricity-rate">Electricity Rate (per unit):</label>
                                <input type="number" id="electricity-rate" value="10" required min="0" step="0.01"
                                    inputmode="decimal">
                            </div>
                            <div class="form-group">
                                <label for="starting-electricity">Starting Electricity Reading:</label>
                                <input type="number" id="starting-electricity" required min="0" step="0.01"
                                    inputmode="decimal">
                            </div>
                        </div>
                        <button type="submit" class="submit-btn">
                            <i class="fas fa-save"></i> Add Tenant
                        </button>
                    </form>
                </section>

                <!-- Payment History Section -->
                <section id="payment-history" class="section">
                    <h2><i class="fas fa-history"></i> Payment History</h2>
                    <div class="payment-filters">
                        <select id="payment-tenant-select">
                            <option value="">All Tenants</option>
                        </select>
                        <input type="month" id="payment-month">
                        <label class="all-months-option">
                            <input type="checkbox" id="all-months">
                            All Months
                        </label>
                    </div>
                    <div class="payment-summary">
                        <div class="summary-card">
                            <i class="fas fa-money-bill-wave"></i>
                            <span id="total-payments">₹0</span>
                            <label>Total Payments</label>
                        </div>
                        <div class="summary-card" id="monthly-summary" style="display: none;">
                            <i class="fas fa-calendar-check"></i>
                            <span id="monthly-payments">₹0</span>
                            <label>Monthly Payments</label>
                        </div>
                    </div>
                    <div class="payment-history-list" id="payment-history-list">
                        <!-- Payment history will be displayed here -->
                    </div>
                </section>

                <!-- Monthly History Section -->
                <section id="monthly-history" class="section">
                    <h2><i class="fas fa-calendar-alt"></i> Monthly History</h2>
                    <div class="monthly-history-container">
                        <div class="monthly-stats">
                            <div class="monthly-stat-card">
                                <h3>Total Monthly Rent</h3>
                                <p id="monthly-total-rent">₹0</p>
                            </div>
                            <div class="monthly-stat-card">
                                <h3>Total Monthly Bills</h3>
                                <p id="monthly-total-bills">₹0</p>
                            </div>
                            <div class="monthly-stat-card">
                                <h3>Total Monthly Payments</h3>
                                <p id="monthly-total-payments">₹0</p>
                            </div>
                            <div class="monthly-stat-card">
                                <h3>Total Payments</h3>
                                <p id="total-payments-till-now">₹0</p>
                            </div>
                            <div class="monthly-stat-card">
                                <h3>Total Bills</h3>
                                <p id="total-bills-till-now">₹0</p>
                            </div>
                        </div>
                        <div class="monthly-history-list">
                            <h3>Monthly Breakdown</h3>
                            <div id="monthly-breakdown"></div>
                        </div>
                    </div>
                </section>

                <!-- Data Management Section -->
                <section id="data-management" class="section">
                    <h2><i class="fas fa-database"></i> Data Management</h2>
                    <div class="data-management-buttons">
                        <button id="sync-data" class="action-btn">
                            <i class="fas fa-sync"></i> Sync Data
                        </button>
                        <button id="export-data" class="action-btn">
                            <i class="fas fa-download"></i> Export Data
                        </button>
                        <label for="import-data" class="action-btn">
                            <i class="fas fa-upload"></i> Import Data
                            <input type="file" id="import-data" accept=".json" style="display: none;">
                        </label>
                    </div>
                    <div id="sync-status" class="sync-status" style="display: none;">
                        <span class="sync-message"></span>
                    </div>
                </section>
            </div>
        </div>

        <!-- Tenant Details Modal -->
        <div id="tenant-details-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Tenant Details</h2>
                    <button id="close-tenant-details" class="close-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="tenant-details-info">
                        <h3 id="tenant-detail-name" style="cursor: pointer;"></h3>
                        <p>Room: <span id="tenant-detail-room"></span></p>
                        <p>Monthly Rent: <span id="tenant-detail-rent"></span></p>
                        <p>Current Due: <span id="tenant-detail-due"></span></p>
                        <p>Electricity Rate: <span id="tenant-detail-rate"></span>/unit</p>
                    </div>

                    <div class="tabs" role="tablist" aria-label="Tenant details tabs">
                        <button class="tab-btn active" role="tab" aria-selected="true" aria-controls="payments-tab"
                            id="tab-payments" data-tab="payments">Payment History</button>
                        <button class="tab-btn" role="tab" aria-selected="false" aria-controls="electricity-tab"
                            id="tab-electricity" data-tab="electricity">Electricity Readings</button>
                    </div>

                    <div id="payments-tab" class="tab-content active" role="tabpanel" aria-labelledby="tab-payments">
                        <div class="table-container">
                            <table id="payment-history-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Amount</th>
                                        <th>Type</th>
                                        <th>Notes</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="payment-history-body">
                                    <!-- Payment history will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div id="electricity-tab" class="tab-content" role="tabpanel" aria-labelledby="tab-electricity">
                        <div class="table-container">
                            <table id="electricity-readings-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Reading</th>
                                        <th>Units</th>
                                        <th>Amount</th>
                                    </tr>
                                </thead>
                                <tbody id="electricity-readings-body">
                                    <!-- Electricity readings will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js" defer></script>
    <script src="/script.js" defer></script>

    <!-- Service worker registration moved to script.js (setupServiceWorkerUpdatePrompt) -->
</body>

</html>